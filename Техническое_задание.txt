# TestOps Copilot - Техническое задание

## Кейс: TestOps Copilot

**Задача:** Разработайте AI-ассистента, который будет автоматизировать рутинную работу QA-инженера.

## Оглавление

1. Задача
2. Базовый функционал, которым должен обладать прототип
3. Дополнительный функционал
4. Детализация технических требований
5. Чек-лист: требования к MVP
6. Рекомендуемый технологический стек
7. Детализация кейсов
8. Критерии успеха агента
9. Критерии оценки

## 1. Задача

Создайте agentic-систему на базе Cloud.ru Evolution Foundation Model, которая:

- Автоматически генерирует тест-кейсы в формате Allure TestOps as Code (Python).
- Генерирует автоматизированные тесты (e2e UI и API) на основе Allure TestOps as Code и спецификаций.
- Оптимизирует существующие тест-кейсы за счет анализа покрытия и дубликатов.
- Проверяет тест-кейсы на соответствие принятым стандартам.

### Демонстрационные кейсы

Агент будет протестирован на двух реальных сценариях.

**Кейс 1. UI-тестирование калькулятора цен**
- **Продукт:** Cloud.ru Price Calculator
- **URL:** https://cloud.ru/calculator
- **Покрытие:**
  - Начальная страница и основной flow (добавление сервисов, конфигурация, расчет стоимости).
  - Каталог продуктов Evolution Cloud.ru (Compute, Object Storage, Kubernetes и др.).
  - Интерактивные калькуляторы для 8 продуктов (включая Free Tier варианты).

**Кейс 2. API-тестирование Evolution Compute**
- **Продукт:** Evolution Compute Public API v3
- **Endpoint:** https://compute.api.cloud.ru
- **Разделы:**
  - VMs (Virtual Machines) CRUD-операции.
  - Disks (управление диском).
  - Flavors (конфигурации инстансов).
- **Аутентификация:** Bearer токен (userPlaneApiToken)
- **Спецификация:** OpenAPI 3.0

## 2. Базовый функционал, которым должен обладать прототип

### 1. Генерация ручных тест-кейсов
Агент должен:
- На входе принимать описание требований (UI-требования, API-спецификация).
- В процессе:
  - Парсить требования,
  - Применять паттерн AAA (Arrange-Act-Assert),
  - Генерировать Python-код с декораторами Allure.
- На выходе выдавать Python-код тест-кейса в формате Allure TestOps as Code.

Приложение 1. Формат генерируемого кода

```python
@allure.manual
@allure.label("owner", owner)
@allure.feature(feature)
@allure.story(story)
@allure.suite(test_type)
@mark.manual
class RegistrationFormTests:
    @allure.title(test_title)
    @allure.link(jira_link, name=jira_name)
    @allure.tag("CRITICAL" | "NORMAL" | "LOW")
    @allure.label("priority", priority)
    def test_function_name(self) -> None:
        with allure_step(step1):
            pass
        with allure_step(step2):
            pass
        with allure_step(step3):
            allure.attach.file(
                "screenshots/registration_form.png",
                name="registration_form",
                attachment_type=allure.attachment_type.PNG,
            )
```

### 2. Генерация автоматизированных тестов
- Для UI (e2e): на базе тест-кейсов и требований → pytest-код.
- Для API: на базе OpenAPI спецификации → pytest-код с проверками.

### 3. Оптимизация тест-кейсов
Агент должен:
- Анализировать покрытие функционала тестами (что покрыто, что нет).
- Находить дублирующиеся, устаревшие или конфликтующие тесты.
- Выявлять пробелы в покрытии.
- Предлагать улучшения на основе типовых дефектов и критичности сценариев.

### 4. Проверка тест-кейсов на стандарты
На основе стандарта в Allure и предоставленных правил агент:
- Проверяет структуру тест-кейса: наличие описания, шагов, ожидаемых результатов.
- Оценивает соответствие паттерну AAA.
- Проверяет корректность и полноту Allure-декораторов и меток.
- Формирует отчет о соответствии стандартам с рекомендациями по улучшению.

## 3. Дополнительный функционал

Желательно, но не обязательно:
- Генерация тест-планов на основе аналитики покрытия.
- Интеграция с историческими данными о дефектах.
- Парсинг кода для выявления тестируемых API-эндпоинтов.
- Генерация unit-тестов для CI/CD pipeline jobs.

## 4. Детализация технических требований

### 1. Использование Cloud.ru Evolution Foundation Model
- Все генерации, анализ требований и оптимизации должны выполняться с использованием Cloud.ru Evolution Foundation Model.
- Взаимодействие с LLM — через официальный API Cloud.ru.

### 2. Форматы
- Тест-кейсы генерируются строго в формате Allure TestOps as Code на Python.
- Обязательны:
  - Паттерн AAA,
  - Корректные декораторы Allure,
  - Метки приоритета, владельца, фича/стори,
  - Корректное именование тестовых классов и методов.

### 3. Интеграции
- GitLab API (v4): для работы с репозиториями и CI/CD.
- OpenAPI 3.0: парсинг для API-спецификаций.
- Аутентификация:
  - Bearer-токены для Evolution API (userPlaneApiToken).
  - Personal Access Token для GitLab.

## 5. Чек-лист: требования к MVP

### MVP v1.0 (Обязательно):
- Генерация ручных тест-кейсов для UI калькулятора (15+ кейсов).
- Генерация ручных тест-кейсов для API VMs (15+ кейсов).
- Генерация автоматизированных e2e тестов (pytest).
- Генерация автоматизированных API тестов (pytest).
- Валидация генерируемых тест-кейсов на соответствие стандартам.
- Интеграция с Cloud.ru Evolution Foundation Model.
- Работающий Docker setup (frontend и backend).
- Базовая документация и примеры.
- Лайв-демонстрация генерации тестов во время защиты.

### MVP v1.1 (Желательно):
- Оптимизация тестов (анализ покрытия, выявление дублей).
- Интеграция с GitLab (commit тест-кейсов).
- Генератор тест-плана.
- Интеграция с историческими данными о дефектах.
- Unit-тесты для основных модулей (60%+ покрытия).
- API-документация (Swagger).

## 6. Рекомендуемый технологический стек

| Компонент          | Технология                          | Версия (рекомендуемая) |
|--------------------|-------------------------------------|------------------------|
| Frontend           | React + TypeScript                  | 19+                    |
| UI Framework       | snack-uikit (опционально)           | latest                 |
| Backend            | Python + FastAPI                    | 3.10+                  |
| Агент              | Python + LangChain / ADK / кастомная логика + A2A Compatibility | - |
| API-клиенты        | httpx, requests                     | latest                 |
| Тестирование       | pytest                              | 7+                     |
| Контейнеризация    | Docker + docker-compose             | latest                 |
| CI/CD              | GitLab CI                           | latest                 |

## 7. Детализация кейсов

### Кейс 1. UI-тестирование калькулятора цен

Необходимо покрыть тест-кейсами весь основной пользовательский сценарий работы с продуктом Cloud.ru "https://cloud.ru/calculator":
- Начальная страница калькулятора.
- Каталог продуктов Evolution Cloud.ru.
- Конфигурация продуктов (на примере Compute).
- Управление конфигурацией сервисов.
- Мобильная адаптация интерфейса.

**Блоки тестирования:**

**Блок 1. Начальная страница**
- Отображение главной страницы с пояснительным текстом.
- Кнопка "Добавить сервис" доступна и кликабельна.
- Отображение шагов процесса (добавление → конфигурация → подключение).
- Отображение текущей общей стоимости (с указанием «в месяц с НДС»).
- Отображение дисклеймера об отсутствии офертности.

**Блок 2. Каталог продуктов**
- Отображение категорий продуктов (Инфраструктура, Сети, Хранение, Контейнеры, Платформы данных, ML/AI).
- Отображение популярных продуктов (Compute, Object Storage).
- Отображение Free Tier вариантов.
- Поиск и фильтрация по продуктам.
- Выбор продукта переводит на конфигурацию.

**Блок 3. Конфигурация продукта (пример — Compute)**
- Отображение параметров (CPU, RAM, диск, регион, тариф).
- Диапазоны выбора вместо ручного ввода.
- Динамический расчет цены при изменении параметра.
- Тултипы с описанием параметров.
- Зависимые поля меняются корректно (например, выбор региона влияет на цену).
- Максимум 99 экземпляров одного продукта (кроме исключений).

**Блок 4. Управление конфигурацией**
- Добавление нескольких сервисов в одну конфигурацию.
- Удаление сервиса из конфигурации.
- Сравнительный режим (2–3 конфигурации).
- Скачивание расчета (PDF/JSON).
- Поделиться ссылкой на конфигурацию.
- Кнопка «Подключить» для каждого продукта (кроме Arenadata DB).
- Free Tier можно добавить только один раз.

**Блок 5. Mobile Responsiveness**
- Интерфейс адаптирован под мобильные устройства.
- Цена видна крупным шрифтом.
- Все элементы управления доступны на мобильных.

**Генерируемые артефакты:**
- 25–35 ручных тест-кейсов (Allure TestOps as Code).
- Автоматизированные e2e тесты (Playwright).
- Тест-план с приоритизацией.

### Кейс 2. API-тестирование Evolution Compute

Необходимо покрыть тест-кейсами все эндпоинты из разделов VMs, Disks, Flavors публичного API продукта Evolution Compute (Виртуальные машины).

**Ссылки:**
- API-спецификация: https://cloud.ru/docs/virtual-machines/ug/topics/api-ref-v3
- Базовый endpoint: https://compute.api.cloud.ru
- Инструкция по аутентификации: https://cloud.ru/docs/virtual-machines/ug/topics/api-ref__authentication?source-platform=Evolution

**Общие условия выполнения запросов:**
- Все операции требуют аутентификации через Bearer-токен userPlaneApiToken.
- Все идентификаторы должны соответствовать формату UUIDv4.
- Все ошибочные HTTP-ответы возвращают массив объектов с кодом и сообщением, оформленных по схемам *ExceptionSchema.

**Блоки тестирования:**

**Блок 1. Раздел VMs (Виртуальные машины)**
- Получение списка виртуальных машин.
- Изменение статуса виртуальной машины.
- Создание виртуальной машины.
- Получение информации о виртуальной машине.
- Обновление виртуальной машины.
- Удаление виртуальной машины.

**Блок 2. Раздел Disks**
- Получение списка дисков.
- Создание диска.
- Получение информации о диске.
- Обновление диска.
- Удаление диска.
- Подключение диска к ВМ.
- Отключение диска от ВМ.

**Блок 3. Раздел Flavors**
- Получение списка доступных флейворов.
- Получение информации по конкретному флейвору.

**Генерируемые артефакты:**
- 25–35 ручных тест-кейсов (Allure TestOps as Code).
- Автоматизированные e2e тесты (pytest).
- Тест-план с приоритизацией.

## 8. Критерии успеха агента

### Функциональность
- Корректная генерация тест-кейсов по AAA паттерну.
- Генерируемый код валиден и запускается без синтаксических ошибок.
- Все обязательные Allure декораторы присутствуют.
- Автотесты генерируются на основе тест-кейсов и спецификаций.

### Качество интеграции
- Успешная аутентификация в Evolution API.
- Корректный парсинг OpenAPI спецификации.
- Обработка ошибок сети и timeout'ов.
- Graceful failover при недоступности LLM.

### Эффективность LLM
- Корректная интерпретация требований.
- Генерируемые тест-кейсы покрывают критические сценарии.
- Предложения по оптимизации содержат практическую ценность.
- Не менее 80% генерируемого кода требует минимальных правок.

### Архитектура и качество кода
- Чистое разделение ответственности (слои агента, модули, интеграции).
- Async/await паттерны для параллельной обработки.
- Полная документация (README, API docs, примеры).
- Unit-тесты для критических модулей (≥60% покрытия).

### Производительность
- Время генерации одного тест-кейса: < 5 секунд.
- Время генерации пакета (5–10 кейсов): < 30 секунд.
- Использование памяти: < 500MB в покое.

## 9. Критерии оценки

Ваше решение оценивается по четырем критериям. По каждому из критериев можно набрать от 1 до 5 баллов. Каждый критерий имеет свой вес в процентах от итогового балла за данный критерий.

| Критерий | Описание | Вес |
|----------|----------|-----|
| **Соответствие функционалу** | Полнота реализации функционала согласно ТЗ, качество генерируемых тест-кейсов и кода, корректность интеграции с API | 40% |
| **Качество кода и архитектура** | Разделение ответственности между модулями, использование async/await и best practices, наличие тестов и документации, наличие логирования, обработка ошибок и edge cases | 25% |
| **Интеграция с LLM и API** | Эффективность взаимодействия с Cloud.ru Evolution Model, качество парсинга требований и спецификаций, точность генерируемого кода | 25% |
| **UX и демонстрация** | Разделение ответственности, поддерживаемость, наличие документации | 10% |

**Бонусные баллы** за:
- Дополнительный функционал (интеграции, оптимизация).
- Инновационные подходы в использовании LLM.
- Высокую производительность решения.